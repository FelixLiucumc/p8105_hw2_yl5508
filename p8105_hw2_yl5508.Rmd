---
title: "p8105_hw2_yl5508"
author: "Yifei LIU"
date: 2023/9/30
output: github_document
---

It's a proj for HW2 about DATA WRANGLING.

```{r, echo = FALSE, message = FALSE}
library(tidyverse)
library(readxl)
```

## Problem 1

### Problem 1.1 DATA CLEANING

`pols_data` is from `pols-month.csv`. Variables are arranged by order of `year-month`, `year`, `month`, `president`, ... .

```{r, message = FALSE}
pols_data =
  read_csv("./datastore/pols-month.csv") |>
  janitor::clean_names() |>
  separate(mon, into = c("year", "month", "day"), "-") |>
  mutate(month = month.name[as.numeric(month)]) |>
  mutate(year_month = paste(year, month, sep = "-")) |>
  #the same as
  #mutate(month = case_match(month, case_match(month,"01"~"Jan"), ...)
  #OR using
  #mutate(month = case_when(month=="01"~"Jan"), ...)
  mutate(president = case_when(
    prez_gop != "0" ~ "gop",
    prez_dem != "0" ~ "dem"
  )) |>
  select(-c("day", "prez_gop", "prez_dem")) |>
  select(year_month, year, month, president, everything())
head(pols_data, 5)
```

`snp_data` is from `snp.csv`. Variables are arranged by order of `year-month`, `year`, `month`, `close`.

```{r, message = FALSE}
snp_data =
  read_csv("./datastore/snp.csv") |>
  janitor::clean_names() |>
  separate(date, into = c("month", "day", "year"), "/") |>
  mutate(year = str_replace_all((ifelse(year >= 30 & year <= 99,  paste("19", year), paste("20", year))),"[^0-9]", "")) |>
  mutate(month = month.name[as.numeric(month)]) |>
  mutate(year_month = paste(year, month, sep = "-")) |>
  select(-day) |>
  select(year_month, year, month, everything())
head(snp_data, 5)
```

`unemployment_data` is from `unemployment.csv`. Variables are arranged by order of `year-month`, `year`, `month`, `unemployment_rate`.

```{r, message = FALSE}
unemployment_data =
  read_csv("./datastore/unemployment.csv") |>
  janitor::clean_names() |>
  pivot_longer(
    jan:dec,
    names_to = "month",
    values_to = "unemployment_rate"
  ) |>
  mutate(month = month.name[match(str_to_title(month), month.abb)]) |>
  mutate(year_month = paste(year, month, sep = "-")) |>
  select(year_month, year, month, everything())
head(unemployment_data, 5)
```

### Problem 1.2 JOINING DATASETS
```{r, message = FALSE}
pols_snp = inner_join(pols_data, snp_data, by = "year_month") |>
  rename(year = year.x, month = month.x) |>
  select(year_month, year, month, president, close) |>
  arrange(year)
head(pols_snp, 5)
```

```{r, message = FALSE}
skimr::skim(pols_snp)
```

## Problem 2

### Problem 2.1 DATA CLEANING

```{r, message = FALSE}
mrt_data =
  read_excel("./datastore/202207 Trash Wheel Collection Data.xlsx", sheet = 1, range = "A2:N549") |>
  janitor::clean_names() |>
  separate(date, into=c("y", "m", "day"), sep = "-") |>
  select(-y, -m) |>
  mutate(year = as.character(year)) |>
  mutate(homes_powered = weight_tons*500/30) |>
  mutate(sourcename = "Mr. Trash Wheel") |>
  select(sourcename, year, month, day, homes_powered, weight_tons, volume_cubic_yards, plastic_bottles, polystyrene, cigarette_butts)
head(mrt_data, 5)

pro_data =
  read_excel("./datastore/202207 Trash Wheel Collection Data.xlsx", sheet = 2, range = "A2:M96") |>
  janitor::clean_names() |>
  separate(date, into=c("y", "m", "day"), sep = "-") |>
  select(-y, -m) |>
  mutate(year = as.character(year)) |>
  mutate(homes_powered = weight_tons*500/30) |>
  mutate(sourcename = "Professor Trash Wheel") |>
  select(sourcename, year, month, day, homes_powered, weight_tons, volume_cubic_yards, plastic_bottles, polystyrene, cigarette_butts)
head(pro_data, 5)

gwy_data =
  read_excel("./datastore/202207 Trash Wheel Collection Data.xlsx", sheet = 4, range = "A2:K108") |>
  janitor::clean_names() |>
  separate(date, into=c("y", "m", "day"), sep = "-") |>
  select(-y, -m) |>
  mutate(year = as.character(year)) |>
  mutate(homes_powered = weight_tons*500/30) |>
  mutate(sourcename = "Gwynnda") |>
  select(sourcename, year, month, day, homes_powered, weight_tons, volume_cubic_yards, plastic_bottles, polystyrene, cigarette_butts)
head(gwy_data, 5)

total_data = 
  bind_rows(mrt_data, pro_data, gwy_data) |>
  arrange(year, match(month, month.name), day)
head(total_data, 5)
```

```{r, message = FALSE}
skimr::skim(total_data)
```

`#` of observations in resulting dataset is `r nrow(total_data)``.
total weight collected by Professor Trash Wheel is `r total_data |> filter(sourcename == "Professor Trash Wheel") |> summarise(sum(weight_tons))`

`r total_data |> filter(sourcename == "Professor Trash Wheel") |> summarise(sum(cigarette_butts))`

` total_data |> filter(sourcename == "Professor Trash Wheel") |> sum(weight_tons)`

` total_data |> filter(sourcename == "Professor Trash Wheel") |> sum(pull(weight_tons))`.


## Problem 3

### Problem 3.1 DATA CLEANING








